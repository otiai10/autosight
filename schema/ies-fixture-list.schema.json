{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "ies-fixture-list-schema",
  "title": "IES照明器具リストスキーマ",
  "description": "IESアプリ用照明器具リストExcelファイルの構造定義。照明設計プロジェクトで使用する器具情報を管理するためのマスターデータ形式を規定する。",
  "version": "2.0.0",

  "excel": {
    "filePattern": "^\\d{6}_ies.*\\.xlsx$",
    "filePatternDescription": "ファイル名は「YYMMDD_ies〜.xlsx」形式。例: 260102_iesアプリ用照明器具リスト例_正規化後_v1.xlsx",

    "sheets": {
      "Fixture Base": {
        "description": "照明器具のマスターデータベース。プロジェクトで使用する全ての照明器具の仕様・コスト情報を一元管理する。各行が1つの器具タイプに対応し、Spec No.をキーとして他シートから参照される。",
        "headerRow": 1,
        "dataStartRow": 3,
        "skipRows": [2],
        "skipRowsDescription": "2行目は注釈行（*Insert new Rows...）のためスキップ",

        "columns": [
          {
            "key": "spec_no",
            "name": "Spec No.",
            "type": "string",
            "required": true,
            "pattern": "^[A-Z]+\\d+[a-z]*$",
            "description": "器具記号。図面や仕様書で器具を識別するためのユニークな記号。アルファベット大文字+数字の組み合わせで構成される。例: A01, A01n, D11w, KL01, FF01 など。サフィックス（n, w, s等）はバリエーションを示す。"
          },
          {
            "key": "date",
            "name": "Date",
            "type": "date",
            "required": false,
            "description": "器具情報の更新日。最終更新日を記録し、仕様変更の履歴管理に使用する。"
          },
          {
            "key": "revision",
            "name": "Rev.",
            "type": "string",
            "required": false,
            "description": "リビジョン番号。器具仕様の改訂履歴を管理する。初期は「-」、以降は数字またはアルファベットで更新を示す。"
          },
          {
            "key": "omitted",
            "name": "omitted",
            "type": "number",
            "enum": [0, 1],
            "description": "除外フラグ。0=有効、1=除外。プロジェクトから除外された器具を論理削除するために使用。物理的に行を削除せず履歴を残す。"
          },
          {
            "key": "luminaire_type",
            "name": "Luminaire_Type",
            "type": "string",
            "required": true,
            "description": "器具タイプの名称。器具の種類・用途を示す日本語名称。改行で開口径や特殊仕様を記載。例: アジャスタブルダウンライト\\n(φ50)、ペンダント、ブラケット、間接照明など。"
          },
          {
            "key": "light_source_type",
            "name": "Light source type",
            "type": "string",
            "enum": ["LED", "蛍光灯", "HID", "ハロゲン"],
            "description": "光源の種類。現在はほぼ全てLEDだが、既存器具との互換性のため他の光源タイプも定義可能。"
          },
          {
            "key": "color_temp",
            "name": "色温度",
            "type": "string",
            "pattern": "^\\d+K$",
            "enum": ["2700K", "3000K", "3500K", "4000K", "5000K", "6500K"],
            "description": "光源の色温度（ケルビン）。照明の色味を示す。2700K=電球色（暖色）、3000K=温白色、4000K=白色、5000K=昼白色、6500K=昼光色（寒色）。"
          },
          {
            "key": "beam_angle",
            "name": "配光角",
            "type": "string",
            "pattern": "^\\d+°",
            "description": "光の広がり角度（ビーム角）。光度が最大値の50%になる角度で定義される。狭角(10-20°)=スポット照明、中角(25-40°)=一般照明、広角(50°以上)=拡散照明。「+lens」等の記載はオプションレンズ使用時を示す。"
          },
          {
            "key": "lumen",
            "name": "Lumen",
            "type": "number",
            "minimum": 0,
            "description": "光束値（ルーメン）。光源から発せられる光の総量を示す。照度計算の基礎データとなる。器具効率を考慮した「器具光束」を記載する。"
          },
          {
            "key": "wattage",
            "name": "消費電力",
            "type": "number",
            "minimum": 0,
            "description": "消費電力（ワット）。器具全体（光源+電源装置）の消費電力。電気設備設計での負荷計算、ランニングコスト算出に使用する。"
          },
          {
            "key": "va",
            "name": "VA",
            "type": "number",
            "minimum": 0,
            "description": "皮相電力（ボルトアンペア）。電源容量の計算に使用する。力率を考慮した実際の電源負荷を示す。"
          },
          {
            "key": "unit",
            "name": "Unit",
            "type": "string",
            "enum": ["個", "台", "セット", "m"],
            "description": "数量単位。通常は「個」だが、間接照明など長さで指定する場合は「m」を使用する。"
          },
          {
            "key": "manufacturer",
            "name": "メーカー",
            "type": "string",
            "required": true,
            "description": "器具メーカー名。日本の主要照明メーカー: コイズミ照明、大光電機、遠藤照明、パナソニック、オーデリック、山田照明、マックスレイなど。"
          },
          {
            "key": "fixture",
            "name": "FIXTURE",
            "type": "string",
            "required": true,
            "description": "メーカーの製品型番。発注・見積に使用する正式な型番を記載する。"
          },
          {
            "key": "model_note",
            "name": "型番備考",
            "type": "string",
            "description": "型番に関する補足情報。特注品の場合は「特注加工」と記載。"
          },
          {
            "key": "control",
            "name": "制御",
            "type": "string",
            "enum": ["DALI調光", "PWM調光", "位相調光", "1-10V調光", "非調光", "Bluetooth", "無線"],
            "description": "調光制御方式。DALI=デジタル制御（推奨）、PWM=パルス幅変調、位相調光=従来型調光器対応、1-10V=アナログ信号制御。"
          },
          {
            "key": "psu",
            "name": "PSU",
            "type": "string",
            "description": "電源装置（Power Supply Unit）の情報。調光電源の型番など。例: DALI調光電源：XE92701"
          },
          {
            "key": "accessories",
            "name": "ACCESSORIES",
            "type": "string",
            "description": "付属品・オプション品の情報。ルーバー、レンズ、フィルター等の型番を記載。例: ハニカムルーバー：XE51946E"
          },
          {
            "key": "notes",
            "name": "注記",
            "type": "string",
            "description": "特記事項・補足情報。塗装色指定（日塗工番号等）、開口寸法、防水仕様、特注内容など。例: トリム指定色塗装(日塗工), Φ50"
          },
          {
            "key": "product_link",
            "name": "製品リンク",
            "type": "string",
            "format": "uri",
            "description": "メーカーの製品ページURL。仕様確認や図面ダウンロードに使用する。"
          },
          {
            "key": "ies_file_check",
            "name": "IES File Check",
            "type": "string",
            "description": "IESファイル（配光データファイル）の有無や状態を示す。照明シミュレーションに必要。"
          },
          {
            "key": "cost_fixture",
            "name": "Cost of Fixture",
            "type": "number",
            "minimum": 0,
            "description": "器具本体の定価（円）。メーカー希望小売価格を記載。実際の仕入れ価格は掛け率を適用して算出する。"
          },
          {
            "key": "cost_driver",
            "name": "Cost of Driver",
            "type": "number",
            "minimum": 0,
            "description": "電源装置（ドライバー）の定価（円）。別置電源の場合に記載。器具内蔵電源の場合はCost of Fixtureに含まれるため空欄。"
          },
          {
            "key": "cost_others",
            "name": "Cost of Others",
            "type": "number",
            "minimum": 0,
            "description": "その他付属品の定価（円）。ルーバー、レンズ、取付金具など、アクセサリー欄に記載した付属品の合計金額。"
          }
        ]
      },

      "器具仕様": {
        "description": "器具仕様集シート。Fixture Baseのデータを印刷用にレイアウトした形式。各ページに複数の器具仕様をカード形式で配置し、設計図書の別紙として使用する。行列を入れ替えた転置形式でデータを表示する。",
        "type": "layout",
        "layoutDescription": "横方向に器具を並べ、縦方向に仕様項目を配置する転置レイアウト。1ページあたり約8器具を表示。",

        "metadata": {
          "title": {
            "cell": "B2",
            "type": "string",
            "fixed": "別紙：照明器具仕様集",
            "description": "シートタイトル。固定文言。"
          },
          "projectName": {
            "cell": "D3",
            "type": "string",
            "description": "プロジェクト名。建物名称や工事名称を記載する。"
          },
          "phase": {
            "cell": "D4",
            "type": "string",
            "enum": ["SD", "DD", "CD", "施工"],
            "description": "設計フェーズ。SD=基本設計、DD=実施設計、CD=工事契約図書、施工=施工段階。"
          },
          "area": {
            "cell": "D5",
            "type": "string",
            "description": "対象エリア。階数やゾーン名を記載。例: 1F, B1F-2F, 共用部 など。"
          },
          "date": {
            "cell": "D6",
            "type": "date",
            "description": "作成日/更新日。この仕様集の発行日を記載する。"
          }
        },

        "fixtureCards": {
          "startColumn": "P",
          "headerRow": 4,
          "description": "P列以降に器具Spec No.が横並びで配置。各カードは器具1台分の仕様を縦に表示する。"
        }
      },

      "器具リスト": {
        "description": "プロジェクト器具リストシート。図面に対応した器具一覧表。数量集計、金額計算、VE検討などに使用する。設計図書の一部として納品する形式。",
        "type": "layout",

        "metadata": {
          "title": {
            "cell": "B4",
            "type": "string",
            "fixed": "照明器具リスト",
            "description": "シートタイトル。固定文言。"
          },
          "projectName": {
            "cell": "C5",
            "type": "string",
            "description": "プロジェクト名。建物名称や工事名称を記載する。"
          },
          "area": {
            "cell": "C6",
            "type": "string",
            "description": "対象エリア。複数階にまたがる場合はカンマ区切り。例: B1F, 1F"
          },
          "drawingNo": {
            "cell": "C7",
            "type": "string",
            "description": "図面番号。この器具リストが対応する電気図面の番号。例: E-2001, XXX-2001"
          },
          "date": {
            "cell": "C8",
            "type": "date",
            "description": "作成日/更新日。リスト発行日を記載する。"
          },
          "revision": {
            "cell": "C9",
            "type": "string",
            "pattern": "^[A-Z]?\\d+$",
            "description": "リビジョン番号。D0=初版、D1=1回目改訂など。Dは「Design」の略。施工段階ではC(Construction)を使用する場合もある。"
          }
        },

        "headerRows": {
          "row1": 11,
          "row2": 12,
          "description": "ヘッダーは2行構成。row1にカラム名、row2にサブカテゴリ（エリア別数量など）"
        },
        "dataStartRow": 14,

        "columns": [
          {
            "key": "spec_no",
            "name": "器具番号",
            "column": "B",
            "type": "string",
            "description": "Fixture BaseのSpec No.を参照"
          },
          {
            "key": "fixture_type",
            "name": "器具タイプ",
            "column": "C",
            "type": "string",
            "description": "Light source type（LED等）"
          },
          {
            "key": "quantity",
            "name": "台数",
            "columns": {
              "select": {"column": "E", "description": "SELECT数量"},
              "prime": {"column": "F", "description": "PRIME数量"},
              "areas": {
                "description": "エリア別数量。列G以降に各エリア（B1F, 1F等）の数量を配置",
                "dynamic": true
              },
              "total": {"column": "I", "description": "合計数量"}
            },
            "description": "器具の数量。SELECT/PRIMEおよびエリア別の内訳"
          },
          {
            "key": "unit",
            "name": "単位",
            "column": "J",
            "type": "string",
            "description": "数量単位（個、m等）"
          },
          {
            "key": "psu",
            "name": "PSU情報",
            "column": "J",
            "type": "string",
            "description": "電源装置の型番情報"
          },
          {
            "key": "lamp_info",
            "name": "ランプ",
            "column": "L",
            "type": "string",
            "description": "色温度と配光角の組み合わせ。例: 2700K 20°"
          },
          {
            "key": "recommended_manufacturer",
            "name": "推奨メーカー",
            "column": "M",
            "type": "string",
            "description": "Fixture Baseの光束値(Lumen)を表示"
          },
          {
            "key": "recommended_model",
            "name": "推奨型番",
            "column": "N",
            "type": "string",
            "description": "Fixture Baseの消費電力を表示"
          },
          {
            "key": "color_temp",
            "name": "色温度/光色",
            "column": "O",
            "type": "string",
            "description": "色温度"
          },
          {
            "key": "unit_display",
            "name": "単位表示",
            "column": "P",
            "type": "string",
            "description": "数量単位（個等）"
          },
          {
            "key": "model",
            "name": "型番",
            "column": "Q",
            "type": "string",
            "description": "器具型番"
          },
          {
            "key": "manufacturer",
            "name": "メーカー",
            "column": "S",
            "type": "string",
            "description": "メーカー名"
          },
          {
            "key": "control",
            "name": "制御",
            "column": "T",
            "type": "string",
            "description": "調光制御方式"
          },
          {
            "key": "accessories",
            "name": "アクセサリー類",
            "column": "V",
            "type": "string",
            "description": "付属品情報"
          },
          {
            "key": "notes",
            "name": "注記",
            "column": "W",
            "type": "string",
            "description": "特記事項"
          }
        ],

        "sections": {
          "priceReference": {
            "description": "金額参照セクション。定価見積からの参照金額を表示。",
            "headerCell": "AB11",
            "headerText": "金額(定価見積から参照)",
            "columns": {
              "fixture": {"column": "Y", "name": "器具", "description": "器具本体価格"},
              "driver": {"column": "Z", "name": "電源", "description": "電源装置価格"},
              "options": {"column": "AA", "name": "オプション", "description": "オプション品価格"},
              "unitPrice": {"column": "AB", "name": "器具単価", "description": "合計単価"},
              "discountRate": {"column": "AC", "name": "掛け率（想定）", "description": "想定掛け率"},
              "subtotal": {"column": "AD", "name": "小計", "description": "小計金額"}
            }
          },
          "estimateReview": {
            "description": "見積もり精査セクション。実際の見積金額との比較検討用。",
            "headerCell": "AF11",
            "headerText": "見積もり精査",
            "columns": {
              "estimatedPrice": {"column": "AF", "name": "見積単価", "description": "見積単価"},
              "actualRate": {"column": "AG", "name": "掛け率", "description": "実際の掛け率"}
            }
          },
          "veProposal": {
            "description": "VE案セクション。Value Engineering（コスト削減）提案用。代替器具や仕様変更案を記載。",
            "headerCell": "AH11",
            "headerText": "VE案",
            "columns": {
              "priceDiff": {"column": "AH", "name": "増減額(参考金額)", "description": "VEによる金額増減"},
              "veContent": {"column": "AI", "name": "VE内容", "description": "VE提案内容"}
            }
          }
        }
      }
    }
  }
}
